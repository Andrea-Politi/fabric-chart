{{- /* shared variables */}}
{{- $clusterName := .Values.clusterName}}
{{- $namespace := printf "explorer-%s" $clusterName }}
{{- $pvcName := printf "%s-shared" $namespace }}

# namespace
{{- $scope := dict "name" $namespace }}
{{- template "namespace" $scope }}

# persistent volume
{{- $name := printf "%s-shared" $namespace }}
{{- $nfsPath := printf "%s/%s/resources/" $.Values.nfs.basePath $clusterName }}
{{- $scope := dict "name" $name "nfsServer" $.Values.nfs.ip "nfsPath" $nfsPath "pvcNamespace" $namespace "pvcName" $pvcName }}
{{- template "persistentVolume" $scope }}

# persistent volume claim
{{- $scope := dict "name" $pvcName "namespace" $namespace }}
{{- template "persistentVolumeClaim" $scope }}

# the deployment of explorer
{{- $name := "explorer" }}
{{- $scope := dict "name" $name "namespace" $namespace "pvc" $pvcName }}
{{- template "explorer.deployment" $scope }}

# the service of explorer
{{- $scope := dict "name" $name "namespace" $namespace }}
{{- template "explorer.service" $scope }}

# the ingress of explorer
{{- $path := printf "/fabric/%s/explorer" $clusterName }}
{{- $scope := dict "name" $name "namespace" $namespace "path" $path "backendServiceName" $name "backendServicePort" "8080" }}
{{- template "ingress" $scope }}